{"version":3,"file":"position_configurator.min.js","sources":["../src/position_configurator.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Position configurator for Tutor-IA avatar placement settings\n *\n * @module     local_dttutor/position_configurator\n * @copyright  2025 Datacurso\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine([], function() {\n\n    /**\n     * Initialize the position configurator\n     */\n    var init = function() {\n        const presetRadios = document.querySelectorAll('input[name=\"position_preset\"]');\n        const customCoordsDiv = document.getElementById('custom-coords');\n        const xInput = document.getElementById('position_x');\n        const yInput = document.getElementById('position_y');\n        const xRefRadios = document.querySelectorAll('input[name=\"ref_x\"]');\n        const yRefRadios = document.querySelectorAll('input[name=\"ref_y\"]');\n        const drawerSideSelect = document.getElementById('drawer_side');\n        const previewAvatar = document.getElementById('preview-avatar');\n        const previewContainer = document.querySelector('.position-preview');\n        const coordsDisplay = document.getElementById('coords-display');\n        const hiddenInput = document.getElementById('id_s_local_dttutor_avatar_position_data');\n\n        if (!previewAvatar || !previewContainer) {\n            return;\n        }\n\n        let isDragging = false;\n        let startX = 0;\n        let startY = 0;\n        let initialLeft = 0;\n        let initialTop = 0;\n\n        /**\n         * Convert pixels to rem units\n         * @param {number} pixels - Pixel value to convert\n         * @returns {string} Value in rem units\n         */\n        function pixelsToRem(pixels) {\n            const fontSize = parseFloat(getComputedStyle(document.documentElement).fontSize);\n            return (pixels / fontSize).toFixed(2) + 'rem';\n        }\n\n        /**\n         * Convert CSS value to pixels\n         * @param {string} value - CSS value to convert\n         * @param {number} containerSize - Container size for relative units\n         * @returns {number} Value in pixels\n         */\n        function cssValueToPixels(value, containerSize) {\n            if (value.endsWith('px')) {\n                return parseFloat(value);\n            } else if (value.endsWith('rem')) {\n                const fontSize = parseFloat(getComputedStyle(document.documentElement).fontSize);\n                return parseFloat(value) * fontSize;\n            } else if (value.endsWith('em')) {\n                const fontSize = parseFloat(getComputedStyle(previewAvatar).fontSize);\n                return parseFloat(value) * fontSize;\n            } else if (value.endsWith('%')) {\n                return (parseFloat(value) / 100) * containerSize;\n            } else if (value.endsWith('vh')) {\n                return (parseFloat(value) / 100) * window.innerHeight;\n            } else if (value.endsWith('vw')) {\n                return (parseFloat(value) / 100) * window.innerWidth;\n            }\n            return 0;\n        }\n\n        /**\n         * Update preview position based on current settings\n         */\n        function updatePreview() {\n            const preset = document.querySelector('input[name=\"position_preset\"]:checked').value;\n            const drawerSide = drawerSideSelect.value;\n            const xRef = document.querySelector('input[name=\"ref_x\"]:checked')?.value || 'left';\n            const yRef = document.querySelector('input[name=\"ref_y\"]:checked')?.value || 'bottom';\n            let x = xInput.value;\n            let y = yInput.value;\n\n            if (preset === 'custom') {\n                customCoordsDiv.classList.add('active');\n            } else {\n                customCoordsDiv.classList.remove('active');\n                if (preset === 'right') {\n                    x = '2rem';\n                    y = '6rem';\n                } else if (preset === 'left') {\n                    x = '2rem';\n                    y = '6rem';\n                }\n            }\n\n            if (preset === 'right') {\n                previewAvatar.style.right = x;\n                previewAvatar.style.left = 'auto';\n                previewAvatar.style.bottom = y;\n                previewAvatar.style.top = 'auto';\n            } else if (preset === 'left') {\n                previewAvatar.style.left = x;\n                previewAvatar.style.right = 'auto';\n                previewAvatar.style.bottom = y;\n                previewAvatar.style.top = 'auto';\n            } else {\n                const rect = previewContainer.getBoundingClientRect();\n                const avatarWidth = previewAvatar.offsetWidth;\n                const avatarHeight = previewAvatar.offsetHeight;\n\n                const xSide = x.startsWith('-') ? 'right' : 'left';\n                const ySide = y.startsWith('-') ? 'top' : 'bottom';\n\n                const xValue = x.replace('-', '');\n                const yValue = y.replace('-', '');\n\n                const xPx = cssValueToPixels(xValue, rect.width);\n                const yPx = cssValueToPixels(yValue, rect.height);\n\n                let leftPx, topPx;\n\n                if (xSide === 'left') {\n                    leftPx = xPx;\n                } else {\n                    leftPx = rect.width - xPx - avatarWidth;\n                }\n\n                if (ySide === 'bottom') {\n                    topPx = rect.height - yPx - avatarHeight;\n                } else {\n                    topPx = yPx;\n                }\n\n                previewAvatar.style.left = leftPx + 'px';\n                previewAvatar.style.top = topPx + 'px';\n                previewAvatar.style.right = 'auto';\n                previewAvatar.style.bottom = 'auto';\n            }\n\n            const xDisplay = preset === 'custom' ? `${x} (from ${xRef})` : x;\n            const yDisplay = preset === 'custom' ? `${y} (from ${yRef})` : y;\n            coordsDisplay.textContent = `Position: ${preset === 'custom' ?\n                `X: ${xDisplay}, Y: ${yDisplay}` : preset + ' corner'} | Drawer: ${drawerSide}`;\n\n            const data = {\n                preset: preset,\n                x: x,\n                y: y,\n                drawerside: drawerSide,\n                xref: xRef,\n                yref: yRef\n            };\n            hiddenInput.value = JSON.stringify(data);\n\n            document.querySelectorAll('.preset-option').forEach(opt => opt.classList.remove('selected'));\n            const selectedOption = document.querySelector(`.preset-option[data-preset=\"${preset}\"]`);\n            if (selectedOption) {\n                selectedOption.classList.add('selected');\n            }\n        }\n\n        /**\n         * Handle mouse move during drag\n         * @param {MouseEvent} e - Mouse event\n         */\n        function handleMouseMove(e) {\n            if (!isDragging) {\n                return;\n            }\n\n            e.preventDefault();\n\n            const rect = previewContainer.getBoundingClientRect();\n            const deltaX = e.clientX - startX;\n            const deltaY = e.clientY - startY;\n\n            let newLeft = initialLeft + deltaX;\n            let newTop = initialTop + deltaY;\n\n            const avatarWidth = previewAvatar.offsetWidth;\n            const avatarHeight = previewAvatar.offsetHeight;\n            newLeft = Math.max(0, Math.min(newLeft, rect.width - avatarWidth));\n            newTop = Math.max(0, Math.min(newTop, rect.height - avatarHeight));\n\n            const fromRight = rect.width - newLeft - avatarWidth;\n            const fromBottom = rect.height - newTop - avatarHeight;\n\n            const xRef = document.querySelector('input[name=\"ref_x\"]:checked')?.value || 'left';\n            const yRef = document.querySelector('input[name=\"ref_y\"]:checked')?.value || 'bottom';\n\n            if (xRef === 'left') {\n                xInput.value = pixelsToRem(newLeft);\n            } else {\n                xInput.value = '-' + pixelsToRem(fromRight);\n            }\n\n            if (yRef === 'bottom') {\n                yInput.value = pixelsToRem(fromBottom);\n            } else {\n                yInput.value = '-' + pixelsToRem(newTop);\n            }\n\n            previewAvatar.style.left = newLeft + 'px';\n            previewAvatar.style.top = newTop + 'px';\n            previewAvatar.style.right = 'auto';\n            previewAvatar.style.bottom = 'auto';\n\n            coordsDisplay.textContent = 'Position: X: ' + xInput.value + ' (from ' + xRef + '), Y: ' +\n                yInput.value + ' (from ' + yRef + ') | Drawer: ' + drawerSideSelect.value;\n        }\n\n        /**\n         * Handle mouse up to end drag\n         */\n        function handleMouseUp() {\n            if (isDragging) {\n                isDragging = false;\n                previewAvatar.classList.remove('dragging');\n                document.removeEventListener('mousemove', handleMouseMove);\n                document.removeEventListener('mouseup', handleMouseUp);\n                updatePreview();\n            }\n        }\n\n        previewAvatar.addEventListener('mousedown', function(e) {\n            e.preventDefault();\n            isDragging = true;\n            previewAvatar.classList.add('dragging');\n\n            const rect = previewContainer.getBoundingClientRect();\n            const avatarRect = previewAvatar.getBoundingClientRect();\n\n            startX = e.clientX;\n            startY = e.clientY;\n\n            initialLeft = avatarRect.left - rect.left;\n            initialTop = avatarRect.top - rect.top;\n\n            const customRadio = document.querySelector('input[name=\"position_preset\"][value=\"custom\"]');\n            if (customRadio) {\n                customRadio.checked = true;\n                customCoordsDiv.classList.add('active');\n            }\n\n            document.addEventListener('mousemove', handleMouseMove);\n            document.addEventListener('mouseup', handleMouseUp);\n        });\n\n        presetRadios.forEach(radio => {\n            radio.addEventListener('change', updatePreview);\n        });\n\n        xInput.addEventListener('input', updatePreview);\n        yInput.addEventListener('input', updatePreview);\n        drawerSideSelect.addEventListener('change', updatePreview);\n\n        xRefRadios.forEach(radio => {\n            radio.addEventListener('change', updatePreview);\n        });\n\n        yRefRadios.forEach(radio => {\n            radio.addEventListener('change', updatePreview);\n        });\n\n        document.querySelectorAll('.preset-option').forEach(opt => {\n            opt.addEventListener('click', function() {\n                const preset = this.dataset.preset;\n                document.querySelector(`input[name=\"position_preset\"][value=\"${preset}\"]`).checked = true;\n                updatePreview();\n            });\n        });\n\n        updatePreview();\n    };\n\n    return {\n        init: init\n    };\n});\n"],"names":["define","init","presetRadios","document","querySelectorAll","customCoordsDiv","getElementById","xInput","yInput","xRefRadios","yRefRadios","drawerSideSelect","previewAvatar","previewContainer","querySelector","coordsDisplay","hiddenInput","isDragging","startX","startY","initialLeft","initialTop","pixelsToRem","pixels","parseFloat","getComputedStyle","documentElement","fontSize","toFixed","cssValueToPixels","value","containerSize","endsWith","window","innerHeight","innerWidth","updatePreview","preset","drawerSide","xRef","yRef","x","y","classList","add","remove","style","right","left","bottom","top","rect","getBoundingClientRect","avatarWidth","offsetWidth","avatarHeight","offsetHeight","xSide","startsWith","ySide","xValue","replace","yValue","xPx","width","yPx","height","leftPx","topPx","xDisplay","yDisplay","textContent","data","drawerside","xref","yref","JSON","stringify","forEach","opt","selectedOption","handleMouseMove","e","preventDefault","deltaX","clientX","deltaY","clientY","newLeft","newTop","Math","max","min","fromRight","fromBottom","handleMouseUp","removeEventListener","addEventListener","avatarRect","customRadio","checked","radio","this","dataset"],"mappings":";;;;;;;AAuBAA,6CAAO,IAAI,iBA2QA,CACHC,KAvQO,iBACDC,aAAeC,SAASC,iBAAiB,iCACzCC,gBAAkBF,SAASG,eAAe,iBAC1CC,OAASJ,SAASG,eAAe,cACjCE,OAASL,SAASG,eAAe,cACjCG,WAAaN,SAASC,iBAAiB,uBACvCM,WAAaP,SAASC,iBAAiB,uBACvCO,iBAAmBR,SAASG,eAAe,eAC3CM,cAAgBT,SAASG,eAAe,kBACxCO,iBAAmBV,SAASW,cAAc,qBAC1CC,cAAgBZ,SAASG,eAAe,kBACxCU,YAAcb,SAASG,eAAe,+CAEvCM,gBAAkBC,4BAInBI,YAAa,EACbC,OAAS,EACTC,OAAS,EACTC,YAAc,EACdC,WAAa,WAORC,YAAYC,eAETA,OADSC,WAAWC,iBAAiBtB,SAASuB,iBAAiBC,WAC5CC,QAAQ,GAAK,eASnCC,iBAAiBC,MAAOC,kBACzBD,MAAME,SAAS,aACRR,WAAWM,OACf,GAAIA,MAAME,SAAS,OAAQ,OACxBL,SAAWH,WAAWC,iBAAiBtB,SAASuB,iBAAiBC,iBAChEH,WAAWM,OAASH,SACxB,GAAIG,MAAME,SAAS,MAAO,OACvBL,SAAWH,WAAWC,iBAAiBb,eAAee,iBACrDH,WAAWM,OAASH,SACxB,OAAIG,MAAME,SAAS,KACdR,WAAWM,OAAS,IAAOC,cAC5BD,MAAME,SAAS,MACdR,WAAWM,OAAS,IAAOG,OAAOC,YACnCJ,MAAME,SAAS,MACdR,WAAWM,OAAS,IAAOG,OAAOE,WAEvC,WAMFC,uEACCC,OAASlC,SAASW,cAAc,yCAAyCgB,MACzEQ,WAAa3B,iBAAiBmB,MAC9BS,oCAAOpC,SAASW,cAAc,6FAAgCgB,QAAS,OACvEU,qCAAOrC,SAASW,cAAc,+FAAgCgB,QAAS,aACzEW,EAAIlC,OAAOuB,MACXY,EAAIlC,OAAOsB,SAEA,WAAXO,OACAhC,gBAAgBsC,UAAUC,IAAI,WAE9BvC,gBAAgBsC,UAAUE,OAAO,WAClB,UAAXR,QAGkB,SAAXA,UAFPI,EAAI,OACJC,EAAI,SAOG,UAAXL,OACAzB,cAAckC,MAAMC,MAAQN,EAC5B7B,cAAckC,MAAME,KAAO,OAC3BpC,cAAckC,MAAMG,OAASP,EAC7B9B,cAAckC,MAAMI,IAAM,YACvB,GAAe,SAAXb,OACPzB,cAAckC,MAAME,KAAOP,EAC3B7B,cAAckC,MAAMC,MAAQ,OAC5BnC,cAAckC,MAAMG,OAASP,EAC7B9B,cAAckC,MAAMI,IAAM,WACvB,OACGC,KAAOtC,iBAAiBuC,wBACxBC,YAAczC,cAAc0C,YAC5BC,aAAe3C,cAAc4C,aAE7BC,MAAQhB,EAAEiB,WAAW,KAAO,QAAU,OACtCC,MAAQjB,EAAEgB,WAAW,KAAO,MAAQ,SAEpCE,OAASnB,EAAEoB,QAAQ,IAAK,IACxBC,OAASpB,EAAEmB,QAAQ,IAAK,IAExBE,IAAMlC,iBAAiB+B,OAAQT,KAAKa,OACpCC,IAAMpC,iBAAiBiC,OAAQX,KAAKe,YAEtCC,OAAQC,MAGRD,OADU,SAAVV,MACSM,IAEAZ,KAAKa,MAAQD,IAAMV,YAI5Be,MADU,WAAVT,MACQR,KAAKe,OAASD,IAAMV,aAEpBU,IAGZrD,cAAckC,MAAME,KAAOmB,OAAS,KACpCvD,cAAckC,MAAMI,IAAMkB,MAAQ,KAClCxD,cAAckC,MAAMC,MAAQ,OAC5BnC,cAAckC,MAAMG,OAAS,aAG3BoB,SAAsB,WAAXhC,iBAAyBI,oBAAWF,UAAUE,EACzD6B,SAAsB,WAAXjC,iBAAyBK,oBAAWF,UAAUE,EAC/D3B,cAAcwD,gCAAsC,WAAXlC,oBAC/BgC,yBAAgBC,UAAajC,OAAS,gCAAuBC,kBAEjEkC,KAAO,CACTnC,OAAQA,OACRI,EAAGA,EACHC,EAAGA,EACH+B,WAAYnC,WACZoC,KAAMnC,KACNoC,KAAMnC,MAEVxB,YAAYc,MAAQ8C,KAAKC,UAAUL,MAEnCrE,SAASC,iBAAiB,kBAAkB0E,SAAQC,KAAOA,IAAIpC,UAAUE,OAAO,oBAC1EmC,eAAiB7E,SAASW,oDAA6CuB,cACzE2C,gBACAA,eAAerC,UAAUC,IAAI,qBAQ5BqC,gBAAgBC,yDAChBjE,kBAILiE,EAAEC,uBAEIhC,KAAOtC,iBAAiBuC,wBACxBgC,OAASF,EAAEG,QAAUnE,OACrBoE,OAASJ,EAAEK,QAAUpE,WAEvBqE,QAAUpE,YAAcgE,OACxBK,OAASpE,WAAaiE,aAEpBjC,YAAczC,cAAc0C,YAC5BC,aAAe3C,cAAc4C,aACnCgC,QAAUE,KAAKC,IAAI,EAAGD,KAAKE,IAAIJ,QAASrC,KAAKa,MAAQX,cACrDoC,OAASC,KAAKC,IAAI,EAAGD,KAAKE,IAAIH,OAAQtC,KAAKe,OAASX,qBAE9CsC,UAAY1C,KAAKa,MAAQwB,QAAUnC,YACnCyC,WAAa3C,KAAKe,OAASuB,OAASlC,aAEpChB,qCAAOpC,SAASW,cAAc,+FAAgCgB,QAAS,OACvEU,qCAAOrC,SAASW,cAAc,+FAAgCgB,QAAS,SAGzEvB,OAAOuB,MADE,SAATS,KACejB,YAAYkE,SAEZ,IAAMlE,YAAYuE,WAIjCrF,OAAOsB,MADE,WAATU,KACelB,YAAYwE,YAEZ,IAAMxE,YAAYmE,QAGrC7E,cAAckC,MAAME,KAAOwC,QAAU,KACrC5E,cAAckC,MAAMI,IAAMuC,OAAS,KACnC7E,cAAckC,MAAMC,MAAQ,OAC5BnC,cAAckC,MAAMG,OAAS,OAE7BlC,cAAcwD,YAAc,gBAAkBhE,OAAOuB,MAAQ,UAAYS,KAAO,SAC5E/B,OAAOsB,MAAQ,UAAYU,KAAO,eAAiB7B,iBAAiBmB,eAMnEiE,gBACD9E,aACAA,YAAa,EACbL,cAAc+B,UAAUE,OAAO,YAC/B1C,SAAS6F,oBAAoB,YAAaf,iBAC1C9E,SAAS6F,oBAAoB,UAAWD,eACxC3D,iBAIRxB,cAAcqF,iBAAiB,aAAa,SAASf,GACjDA,EAAEC,iBACFlE,YAAa,EACbL,cAAc+B,UAAUC,IAAI,kBAEtBO,KAAOtC,iBAAiBuC,wBACxB8C,WAAatF,cAAcwC,wBAEjClC,OAASgE,EAAEG,QACXlE,OAAS+D,EAAEK,QAEXnE,YAAc8E,WAAWlD,KAAOG,KAAKH,KACrC3B,WAAa6E,WAAWhD,IAAMC,KAAKD,UAE7BiD,YAAchG,SAASW,cAAc,iDACvCqF,cACAA,YAAYC,SAAU,EACtB/F,gBAAgBsC,UAAUC,IAAI,WAGlCzC,SAAS8F,iBAAiB,YAAahB,iBACvC9E,SAAS8F,iBAAiB,UAAWF,kBAGzC7F,aAAa4E,SAAQuB,QACjBA,MAAMJ,iBAAiB,SAAU7D,kBAGrC7B,OAAO0F,iBAAiB,QAAS7D,eACjC5B,OAAOyF,iBAAiB,QAAS7D,eACjCzB,iBAAiBsF,iBAAiB,SAAU7D,eAE5C3B,WAAWqE,SAAQuB,QACfA,MAAMJ,iBAAiB,SAAU7D,kBAGrC1B,WAAWoE,SAAQuB,QACfA,MAAMJ,iBAAiB,SAAU7D,kBAGrCjC,SAASC,iBAAiB,kBAAkB0E,SAAQC,MAChDA,IAAIkB,iBAAiB,SAAS,iBACpB5D,OAASiE,KAAKC,QAAQlE,OAC5BlC,SAASW,6DAAsDuB,cAAY+D,SAAU,EACrFhE,sBAIRA"}